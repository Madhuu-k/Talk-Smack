<!DOCTYPE html>
<html>
<head>
  <title>Chat</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
  <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
  
  <h2>Talk Smack</h2>
  <div id="chat-box" style="border:1px solid black; height:200px; overflow-y:scroll;">
    {% for msg in messages %}
      <div class="chat-messages">
        <img src="{{ url_for('static', filename='profile_pics/' ~ msg.profile_pic) }}" class="chat-pic">
        <div class="profile-space">{{ msg.content}} </div>
        <span class="time">{{ msg.timestamp }}</span>
      </div>
    {% endfor %}
  </div>
  <input id="msg" placeholder="Type message...">
  <button onclick="sendMsg()">Send</button>
  <br><a href="/logout">Logout</a>

  <script>
    var socket = io();
    socket.on('message', function(data) {
    let chatBox = document.getElementById('chat-box');

    let div = document.createElement('div');
    div.classList.add('chat-message');
    div.innerHTML = `
        <img src="/static/profile_pics/${data.profile_pic}" class="chat-pic">
        <b>${data.username}</b>: ${data.content}
        <span class="time">${data.timestamp}</span>
    `;

    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;  // auto-scroll
    });

    function sendMsg() {
      var msg = document.getElementById("msg").value;
      socket.send(msg);
      document.getElementById("msg").value = "";
    }
  </script>
</body>
</html>
